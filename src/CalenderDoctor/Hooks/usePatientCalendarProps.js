import React, { useState, useEffect } from "react";
import axios from "axios";
import { useContext } from "react";
import { DisabledatesContext } from "../home";

const usePatientCalendarProps = () => {
  const [date, setDate] = useState(null);
  const {
    dateTemplate,
    disabledDates,
    setDisabledDates,
    datesArray,
    // setDatesArray,
    timeSlots,
    setTimeSlots,
  } = useContext(DisabledatesContext);
  useEffect(() => {
    var config = {
      method: "post",
      url: "https://bedlendule-backend.vercel.app/bedlendule/getAllTimeSlots",
      headers: {
        authorization: localStorage.getItem('access-token')
      },
    };

    axios(config)
      .then(function async(response) {
        // console.log(response)
        const _timeslots = [
          ...new Set(
            response.data.map((e) => new Date(e.startTime).toLocaleDateString())
          ),
        ];
        setTimeSlots(_timeslots);
      })
      .catch(function (error) {
        console.log(error);
      });
  }, []);

  useEffect(() => {
    const _disabledDates = datesArray.filter((e) => !timeSlots.includes(e));
    setDisabledDates(_disabledDates);
  }, [timeSlots, datesArray]);

  return {
    date,
    setDate,
    timeSlots,
    setTimeSlots,
    dateTemplate,
    datesArray,
    disabledDates,
  };
};

export default usePatientCalendarProps;
